---
import { Image } from "astro:assets";

import { SITE } from "@/siteConfig";

import profilePicture from "@/assets/algoritmos.png";
---

<div class="mt-8 pt-4 pb-2">
  <div class="block group">
    <Image
      id="profile-image"
      src={profilePicture}
      alt={SITE.name}
      height={256}
      width={256}
      loading="eager"
      draggable="false"
      class="mx-auto size-32 rounded-full transition-all duration-300 ease-in-out"
    />
    <h1 class="mt-4 text-center text-3xl font-semibold text-yellow-500 transition-colors duration-200">{SITE.name}</h1>
  </div>
  <p
    class="mt-1 text-balance text-center text-sm text-lightModeForegroundMuted dark:text-darkModeForegroundMuted"
  >
    {SITE.bio}
  </p>
  
  <!-- Spacer shown when countdown is hidden -->
  <div id="countdown-spacer" class="h-6 hidden"></div>
  {/* <div class="text-center pt-8">
    <a
      href="https://algoritmos1.com"
      class="pt-8 text-lg font-medium uppercase text-lightModeForegroundMuted underline underline-offset-4 hover:text-lightModeForeground dark:text-darkModeForegroundMuted dark:hover:text-darkModeForeground"
    >
      {`← Algoritmos`}
    </a>
  </div> */}
  
  <!-- Componente de cuenta regresiva para parciales -->
  <div id="countdown-container" class="countdown-container text-center py-4 mt-8">
    <h2 class="text-2xl font-bold mb-4" style="color: #E58C61;" id="countdown-title">MESA DE FINAL (10 DE FEBRERO)</h2>
    <div class="countdown-timer text-lg font-mono p-4 mx-4">
      <span id="days">--</span> días, 
      <span id="hours">--</span> horas, 
      <span id="minutes">--</span> min,
      <span id="seconds">--</span> segs
    </div>
    <div class="mt-4 pt-3 border-t border-gray-200 dark:border-gray-700">
      <p class="text-xs text-gray-500 dark:text-gray-500 uppercase tracking-wide" id="next-parcial-info">PRÓXIMO: MESA DE FINAL (24 DE FEBRERO)</p>
    </div>
  </div>

  {/* <div class="text-center pt-8">
    <div>
      <a href="https://chat.whatsapp.com/HsmFlyvX3Qm88cj2aEkzxc" target="_blank" rel="noopener noreferrer">
        <img
          src="/aviso.png"
          alt="Aviso"
          class="mx-auto rounded-lg shadow-md border border-gray-200 dark:border-gray-700"
        />
      </a>
    </div>
  </div> */}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    function updateCountdown() {
      // Fechas de los finales (hora 10:00 -03:00)
      const final1 = new Date('2026-02-10T10:00:00-03:00'); // MESA DE FINAL 1
      const final2 = new Date('2026-02-24T10:00:00-03:00'); // MESA DE FINAL 2

      const now = new Date();

      // Determinar cuál parcial/evento mostrar
      let targetDate, title, nextInfo;

      if (now < final1) {
        targetDate = final1;
        title = "MESA DE FINAL (10 DE FEBRERO)";
        nextInfo = "PRÓXIMO: MESA DE FINAL (24 DE FEBRERO)";
      } else if (now < final2) {
        targetDate = final2;
        title = "MESA DE FINAL (24 DE FEBRERO)";
        nextInfo = "Esperando próximas fechas";
      } else {
        targetDate = final2;
        title = "Finales Completados";
        nextInfo = "Esperando próximas fechas";
      }
      
      const difference = targetDate.getTime() - now.getTime();
      
      // Actualizar título e información del próximo
      document.getElementById('countdown-title').textContent = title;
      document.getElementById('next-parcial-info').textContent = nextInfo;
      
      if (difference <= 0) {
        document.getElementById('days').textContent = '0';
        document.getElementById('hours').textContent = '0';
        document.getElementById('minutes').textContent = '0';
        document.getElementById('seconds').textContent = '0';
        return;
      }
      
      const days = Math.floor(difference / (1000 * 60 * 60 * 24));
      const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((difference % (1000 * 60)) / 1000);
      
      document.getElementById('days').textContent = days.toString().padStart(2, '0');
      document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
      document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
      document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
    }
    
    // Actualizar cada segundo
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // Configuración
    function applyConfig() {
      const config = JSON.parse(localStorage.getItem('appConfig') || '{}');
      
      // Countdown visibility
      const countdownContainer = document.getElementById('countdown-container');
      const countdownSpacer = document.getElementById('countdown-spacer');
      
      if (countdownContainer) {
        if (config.showCountdown === false) {
           countdownContainer.style.display = 'none';
           if (countdownSpacer) countdownSpacer.style.display = 'block';
        } else {
           countdownContainer.style.display = 'block';
           if (countdownSpacer) countdownSpacer.style.display = 'none';
        }
      }

      // Profile Image
      const profileImage = document.getElementById('profile-image');
      if (config.profileImageUrl) {
        if (profileImage) {
          profileImage.src = config.profileImageUrl;
          profileImage.srcset = ''; 
        }
      }
    }

    applyConfig();
    window.addEventListener('config-updated', applyConfig);
  });
</script>
